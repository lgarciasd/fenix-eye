<section
  id="servicios-produccion"
  class="relative w-full py-24 px-6 overflow-hidden bg-black"
>

  <!-- Contenido -->
  <div class="relative max-w-7xl mx-auto z-10">

    <!-- TÃ­tulo -->
    <h2 class="font-title relative z-20 text-center text-3xl sm:text-4xl md:text-6xl font-extrabold uppercase text-[#b18a42] mb-20 tracking-normal md:tracking-wide">
      SERVICIOS DE PRODUCCIÃ“N
    </h2>

    <!-- WRAPPER DECORATIVO -->
    <div class="relative mx-auto w-full max-w-6xl">
      <!-- ðŸ”¥ Llama superior -->
      <div
        class="pointer-events-none absolute left-1/2 -top-55 -translate-x-1/2
               w-[120%] h-[320px]
               bg-no-repeat bg-cover opacity-100 z-0"
        style="
          background-image: url('/Secciones/FenixxEye Productions/fotoscarrousel/optimizadas/fondocarrouselarriba.jpeg');
          mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
          -webkit-mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
        "
      ></div>

      <!-- ðŸ”¥ Llama inferior -->
      <div
        class="pointer-events-none absolute left-1/2 -bottom-28 -translate-x-1/2
               w-[120%] h-[220px]
               bg-no-repeat bg-cover opacity-95 z-0"
        style="
          background-image: url('/Secciones/FenixxEye Productions/fotoscarrousel/optimizadas/fondocarrouselabajo.jpeg');
          mask-image: linear-gradient(to top, black 60%, transparent 100%);
          -webkit-mask-image: linear-gradient(to top, black 60%, transparent 100%);
        "
      ></div>

      <!-- Carrusel -->
      <div class="carousel-stage-servicios" aria-label="Carousel">

        <button class="nav left" id="prev-serv" aria-label="Previous">
          <span class="chev"></span>
        </button>

        <button class="nav right" id="next-serv" aria-label="Next">
          <span class="chev"></span>
        </button>

        <div class="track" id="track-serv">
          <div class="card-serv">
            <img src="/Secciones/FenixxEye Productions/fotoscarrousel/optimizadas/foto1.png" alt="Servicio 1">
          </div>

          <div class="card-serv">
            <img src="/Secciones/FenixxEye Productions/fotoscarrousel/optimizadas/foto2.png" alt="Servicio 2">
          </div>

          <div class="card-serv">
            <img src="/Secciones/FenixxEye Productions/fotoscarrousel/optimizadas/foto3.png" alt="Servicio 3">
          </div>

          <div class="card-serv">
            <img src="/Secciones/FenixxEye Productions/fotoscarrousel/optimizadas/foto4.png" alt="Servicio 4">
          </div>

          <div class="card-serv">
            <img src="/Secciones/FenixxEye Productions/fotoscarrousel/optimizadas/foto5.png" alt="Servicio 5">
          </div>
        </div>

      </div>
    </div>

    </div>

  </div>
</section>

<style>
  .carousel-stage-servicios{
    width: 100%;
    height: 320px;
    position: relative;
    overflow: visible;

    cursor: grab;
    user-select: none;
    touch-action: pan-y;
  }

  .cinta-servicios{
    filter: drop-shadow(0 0 35px rgba(255,0,0,0.25));
  }

  .nav{
    position:absolute;
    top:50%;
    transform: translateY(-50%);
    width:70px;
    height:150px;
    display:flex;
    align-items:center;
    justify-content:center;
    border:none;
    background:transparent;
    cursor:pointer;
    z-index:50;
    transition: opacity .2s ease;
  }

  .nav:hover{
    opacity:.7;
  }

  /* mÃ³vil */
  .nav.left { left: -10px; }
  .nav.right { right: -10px; }

  /* desktop */
  @media (min-width: 768px) {
    .nav.left { left: -120px; }
    .nav.right { right: -120px; }
  }

  .chev{
    width: 24px;
    height: 24px;
    border-right: 3px solid #fff;
    border-bottom: 3px solid #fff;
    transform: rotate(135deg);
  }

  .right .chev{
    transform: rotate(-45deg);
  }

  .track{
    position:absolute;
    inset:0;
    perspective: 1100px;
    perspective-origin: 50% 45%;
  }

  .card-serv{
    position:absolute;
    top:50%;
    left:50%;
    width: 230px;
    height: 220px;
    overflow:hidden;
  }

  .card-serv img{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  /* Activa */
  .card-serv.is-active{
    width: 420px;
    height: 310px;
    opacity: 1;
    z-index: 20;
    border-radius: 30px;
    corner-shape: scoop;
  }

  .card-serv img{
    pointer-events: none;
    user-select: none;
    -webkit-user-drag: none;
  }
</style>

<script is:inline>
(() => {
  const cards = Array.from(document.querySelectorAll('.card-serv'));
  const prev = document.getElementById('prev-serv');
  const next = document.getElementById('next-serv');
  const stage = document.querySelector('.carousel-stage-servicios');

  let active = 2;

  const slots = [
    { x: -500, s: 0.90, r:  0, o: 0.75, z: 5 },
    { x: -281, s: 1.00, r:  0, o: 0.75, z: 8 },
    { x:    0, s: 1.00, r:  0, o: 1.00, z: 20 },
    { x:  281, s: 1.00, r:  0, o: 0.75, z: 8 },
    { x:  500, s: 0.90, r:  0, o: 0.75, z: 5 },
  ];

  const mid = Math.floor(slots.length / 2);
  const mod = (n, m) => ((n % m) + m) % m;

  function circularOffset(i, a, n){
    let d = i - a;
    if (d >  n/2) d -= n;
    if (d < -n/2) d += n;
    return d;
  }

  function render(){
    const n = cards.length;

    cards.forEach((card, i) => {
      const offset = circularOffset(i, active, n);
      const slotIndex = offset + mid;

      card.classList.toggle('is-active', offset === 0);

      if (slotIndex < 0 || slotIndex >= slots.length){
        card.style.opacity = 0;
        card.style.pointerEvents = 'none';
        return;
      }

      const s = slots[slotIndex];

      card.style.transform =
        `translate(-50%, -50%) translateX(${s.x}px) scale(${s.s})`;

      card.style.opacity = s.o;
      card.style.zIndex = s.z;
      card.style.pointerEvents = 'auto';
      card.dataset.offset = offset;
    });
  }

  // =====================
  // click lateral protegido
  // =====================

  let moved = false;

  cards.forEach(card => {
    card.addEventListener('click', () => {
      if (moved) return;

      const offset = Number(card.dataset.offset);
      if (offset === 0) return;

      active = mod(active + (offset > 0 ? 1 : -1), cards.length);
      render();
    });
  });

  prev.onclick = () => {
    active = mod(active - 1, cards.length);
    render();
  };

  next.onclick = () => {
    active = mod(active + 1, cards.length);
    render();
  };

  // =====================
  // DRAG / SWIPE
  // =====================

  let startX = 0;
  let isDown = false;

  function onDown(e){
    isDown = true;
    moved = false;
    startX = e.clientX;
    stage.style.cursor = 'grabbing';
  }

  function onMove(e){
    if (!isDown) return;
    if (Math.abs(e.clientX - startX) > 12) moved = true;
  }

  function onUp(e){
    if (!isDown) return;
    isDown = false;

    const diff = e.clientX - startX;

    if (diff > 70){
      active = mod(active - 1, cards.length);
      render();
    }
    else if (diff < -70){
      active = mod(active + 1, cards.length);
      render();
    }

    stage.style.cursor = 'grab';
  }

  // stage listeners
  stage.addEventListener('pointerdown', onDown);
  stage.addEventListener('pointermove', onMove);
  stage.addEventListener('pointerup', onUp);
  stage.addEventListener('pointerleave', onUp);

  // cards listeners (clave para swipe sobre imagen)
  cards.forEach(card => {
    card.addEventListener('pointerdown', onDown);
    card.addEventListener('pointermove', onMove);
    card.addEventListener('pointerup', onUp);
  });

  render();
})();
</script>
