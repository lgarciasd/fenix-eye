<section
  id="producciones"
  class="relative w-full py-24 px-6 overflow-hidden bg-transparent "
>

  <div class="relative max-w-7xl mx-auto z-10">

    <!-- Título -->
    <h2 class="font-title text-center text-3xl sm:text-4xl md:text-6xl font-extrabold uppercase text-[#b18a42] mb-16 tracking-normal md:tracking-wide">
      PRODUCCIONES RECIENTES
    </h2>
    <br />

    <!-- Cinta roja -->
    <div
      class="cinta-roja relative mx-auto w-full max-w-6xl h-[260px] md:h-[300px] flex items-center justify-center"
      style="background-image: url('/Secciones/TFK House/fondocarrousel.png'); background-size: 100% 100%; background-repeat: no-repeat;"
    >

      <!-- Carrusel -->
      <div class="carousel-stage-producciones" aria-label="Carousel">

        <button class="nav left" id="prev-prod" aria-label="Previous">
          <span class="chev"></span>
        </button>

        <button class="nav right" id="next-prod" aria-label="Next">
          <span class="chev"></span>
        </button>

        <div class="track" id="track-prod">
          <div class="card-prod">
            <img src="/Secciones/TFK House/Optimizadas/foto1.png" alt="Producción 1">
          </div>

          <div class="card-prod">
            <img src="/Secciones/TFK House/Optimizadas/foto2.png" alt="Producción 2">
          </div>

          <div class="card-prod">
            <img src="/Secciones/TFK House/Optimizadas/foto3.jpeg" alt="Producción 3">
          </div>

          <div class="card-prod">
            <img src="/Secciones/TFK House/Optimizadas/foto4.png" alt="Producción 4">
          </div>

          <div class="card-prod">
            <img src="/Secciones/TFK House/Optimizadas/foto5.png" alt="Producción 5">
          </div>
        </div>

      </div>
    </div>

  </div>
</section>

<style>
.carousel-stage-producciones{
  width: 100%;
  height: 320px;
  position: relative;
  overflow: visible;
  
  cursor: grab;
  user-select: none;
  touch-action: pan-y;
}

.nav{
  position:absolute;
  top:50%;
  transform: translateY(-50%);
  width:60px;
  height:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  border:none;
  background:transparent;
  cursor:pointer;
  z-index:50;
  transition: opacity .2s ease;
}

.nav:hover{
  opacity:.7;
}

.nav.left{ left: -40px; }
.nav.right{ right: -40px; }

.chev{
  width: 22px;
  height: 22px;
  border-right: 3px solid #fff;
  border-bottom: 3px solid #fff;
  transform: rotate(135deg);
}

.right .chev{
  transform: rotate(-45deg);
}

.track{
  position:absolute;
  inset:0;
  perspective: 1100px;
  perspective-origin: 50% 45%;
}

.card-prod{
  position:absolute;
  top:50%;
  left:50%;
  width: 210px;
  height: 150px;
  border-radius: 16px;
  overflow:hidden;
  transition:
    transform 520ms cubic-bezier(.2,.85,.2,1),
    opacity 520ms cubic-bezier(.2,.85,.2,1),
    filter 520ms cubic-bezier(.2,.85,.2,1);
  opacity:.3;
  box-shadow: 0 18px 40px rgba(0,0,0,.65);
}

.card-prod img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* Activa sobresale */
.card-prod.is-active{
  width: 520px;
  height: 320px;
  opacity:1;
  z-index:20;
  border-radius: 20px;
}

.card-prod.is-active img {
  border-radius: 20px;
}

.nav{
    position:absolute;
    top:50%;
    transform: translateY(-50%);
    width:60px;
    height:60px;
    display:grid;
    place-items:center;
    border:none;
    background:transparent;
    cursor:pointer;
    z-index:50;
}

  @media (min-width: 768px) {
    .nav.left {
      left: -150px;
    }

    .nav.right {
      right: -150px;
    }
  }

  .chev{
    width: 20px;
    height: 20px;
    border-right: 3px solid #fff;
    border-bottom: 3px solid #fff;
    transform: rotate(135deg);
  }
  .right .chev{ transform: rotate(-45deg); }

  .cinta-roja {
    filter: drop-shadow(0 0 30px rgba(255,0,0,0.25));
  }

  .card-prod img{
    pointer-events: none;
    user-select: none;
    -webkit-user-drag: none;
  }
</style>


<script is:inline>
(() => {
  const cards = Array.from(document.querySelectorAll('.card-prod'));
  const prev = document.getElementById('prev-prod');
  const next = document.getElementById('next-prod');
  const stage = document.querySelector('.carousel-stage-producciones');

  let active = 2;

  const slots = [
    { x: -450, s: 0.90, r:  12, o: 1, b: 0, z: 5 },
    { x: -250, s: 1.00, r:   8, o: 1, b: 0, z: 8 },
    { x:    0, s: 1.00, r:   0, o: 1, b: 0, z: 20 },
    { x:  250, s: 1.00, r:  -8, o: 1, b: 0, z: 8 },
    { x:  460, s: 0.90, r: -12, o: 1, b: 0, z: 5 },
  ];

  const mid = Math.floor(slots.length / 2);
  const mod = (n, m) => ((n % m) + m) % m;

  function circularOffset(i, a, n){
    let d = i - a;
    if (d >  n/2) d -= n;
    if (d < -n/2) d += n;
    return d;
  }

  function render(){
    const n = cards.length;

    cards.forEach((card, i) => {
      const offset = circularOffset(i, active, n);
      const slotIndex = offset + mid;

      card.classList.toggle('is-active', offset === 0);

      if (slotIndex < 0 || slotIndex >= slots.length){
        card.style.opacity = 0;
        card.style.pointerEvents = 'none';
        return;
      }

      const s = slots[slotIndex];

      card.style.transform =
        `translate(-50%, -50%) translateX(${s.x}px) scale(${s.s}) rotateY(${s.r}deg)`;

      card.style.opacity = s.o;
      card.style.zIndex = s.z;
      card.style.filter = `blur(${s.b}px)`;
      card.style.pointerEvents = 'auto';
      card.dataset.offset = offset;
    });
  }

  // click lateral (con protección contra drag)
  let moved = false;

  cards.forEach(card => {
    card.addEventListener('click', () => {
      if (moved) return;

      const offset = Number(card.dataset.offset);
      if (offset === 0) return;

      active = mod(active + (offset > 0 ? 1 : -1), cards.length);
      render();
    });
  });

  prev.onclick = () => {
    active = mod(active - 1, cards.length);
    render();
  };

  next.onclick = () => {
    active = mod(active + 1, cards.length);
    render();
  };

  // ======================
  // ✅ DRAG / SWIPE
  // ======================

  let startX = 0;
  let isDown = false;

  function onDown(e){
    isDown = true;
    moved = false;
    startX = e.clientX;
    stage.style.cursor = 'grabbing';
  }

  function onMove(e){
    if (!isDown) return;
    if (Math.abs(e.clientX - startX) > 12) moved = true;
  }

  function onUp(e){
    if (!isDown) return;
    isDown = false;

    const diff = e.clientX - startX;

    if (diff > 70){
      active = mod(active - 1, cards.length);
      render();
    }
    else if (diff < -70){
      active = mod(active + 1, cards.length);
      render();
    }

    stage.style.cursor = 'grab';
  }

  // stage listeners
  stage.addEventListener('pointerdown', onDown);
  stage.addEventListener('pointermove', onMove);
  stage.addEventListener('pointerup', onUp);
  stage.addEventListener('pointerleave', onUp);

  // cards listeners (clave para que funcione sobre imágenes)
  cards.forEach(card => {
    card.addEventListener('pointerdown', onDown);
    card.addEventListener('pointermove', onMove);
    card.addEventListener('pointerup', onUp);
  });

  render();
})();
</script>
